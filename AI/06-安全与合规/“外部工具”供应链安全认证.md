# 写作提示 —— AI 工厂之“外部工具与供应链安全认证中心”工作手册

**核心类比**：将函数调用安全与沙箱，比作“AI 工厂”的“外部工具与供应链安全认证中心”。这个中心是工厂的“海关”和“质检总局”，负责对所有计划引入工厂的“外部工具”（第三方 API、函数库）进行严格的审查、测试和隔离，确保供应链环节的安全。

**使用说明**：
- 本提示旨在将抽象的函数调用安全风险，转化为一套具象化的“供应链”管理与“进口设备”质检流程。
- 你需要以“AI 工厂chief供应链安全官”的口吻，为“工具集成工程师”和“安全审计员”撰写这份工作手册。

**生成目标**：
- **建立“供应链”风险意识**：清晰地阐明，不受控地引入“外部工具”，相当于给工厂的“生产线”接入了未经检疫的“进口设备”，可能导致“生产事故”（执行危险操作）、“商业间谍活动”（数据泄露）或“生产线瘫痪”（资源耗尽）。
- **建立“供应商准入”制度**：将工具的白名单/黑名单机制，类比为“认证供应商名录”。只有通过安全背景审查、功能稳定可靠的“供应商”，其“工具”才被允许进入工厂。
- **设计“隔离检疫车间”**：将沙箱化执行，比作一个强制性的“隔离检疫车间”。所有“外部工具”的运行，都必须在这个受控环境中进行，其网络、文件系统访问受到严格限制，确保即使“工具”本身存在恶意代码，也无法逃逸并感染“工厂”主体。
- **规范“操作物料”标准**：将参数校验，比作对送入“外部工具”的“操作物料”进行严格的成分检验，拒绝任何可能导致“设备”误操作或崩溃的“不合格物料”。
- **安装“能耗监控与保险丝”**：将资源与超时限制，比作给“隔离车间”安装独立的“电表”和“保险丝”，一旦“工具”运行超时或消耗过多资源，立即“跳闸”，防止其影响主生产线的能源供应。
- **部署“全链路监控探头”**：将审计与告警，比作在“隔离车间”内外安装的全方位“监控探头”和“烟雾报警器”，记录每一次“工具”调用，并在出现异常行为时立即告警。

**大纲建议：《AI 工厂供应链安全准则：“外部工具与供应链安全认证中心”工作手册》**

1.  **第一章：引言 —— 守护工厂的“生命线”**
    *   引入类比，强调“供应链”安全是“AI 工厂”正常运转的生命线。
    *   案例分析：一个“劣质”的“外部工具”如何导致整个“生产任务”的失败。

2.  **第二章：“认证供应商”管理制度（权限与策略）**
    *   建立“供应商”（工具提供方）的风险评级模型。
    *   设计“认证供应商名录”（工具白名单）的申请、审批与定期复核流程。
    *   为不同的“生产车间”（租户/业务线）分配不同的“工具使用许可”。

3.  **第三章：“隔离检疫车间”建设规范（执行环境隔离）**
    *   **核心原则**：永不信任“外部工具”。
    *   **技术选型**：对比“标准集装箱”（容器）、“轻量化隔离舱”（Wasm/Isolate）和“远程检疫岛”（远程 RPC 服务）等不同“隔离车间”方案的优劣。
    *   **代码示例**：以 TypeScript 为例，展示如何使用 `execa` 或 `vm2` 建立一个基础的“隔离车间”。

4.  **第四章：“操作物料”检验标准（参数与输入校验）**
    *   使用 `zod` 等工具，为每个“工具”的“输入物料”定义严格的“规格说明书”（Schema）。
    *   演示如何过滤“危险品”（如 shell 特殊字符、文件路径穿越符）。

5.  **第五章：“能耗监控与安全保险丝”（资源与超时）**
    *   为“隔离车间”配置“能耗上限”（CPU/内存限制）和“最长工作时间”（超时设置）。
    *   演示如何在代码中实现“超时自动断电”。

6.  **第六章：“全链路监控与事故响应”（审计与告警）**
    *   定义“工具操作记录”必须包含的关键字段（操作人、时间、工具、输入、结果、耗时等）。
    *   建立“异常行为模式库”（如高频调用、错误率飙升），并设置自动化“告警规则”。

7.  **附录：实践案例**
    *   **附录 A**：一个完整的 NestJS “安全认证中心”实现，整合权限、隔离、校验、资源限制和审计。
    *   **附录 B**：“红蓝对抗”演练手册，模拟攻击者如何利用“供应链漏洞”渗透“工厂”。

**质量检查清单（“工作手册”审批标准）**：
- **类比是否一致且清晰？**：读者是否能通过“供应链”和“质检”的视角，轻松理解函数调用的安全要点？
- **制度是否可执行？**：“供应商认证”、“隔离检疫”等制度，是否有明确的、可操作的流程和技术实现路径？
- **风险覆盖是否全面？**：是否覆盖了从“准入”到“运行”再到“监控”的全生命周期风险？
- **代码示例是否具有指导性？**：示例代码是否清晰地演示了核心安全机制的实现？