## ç®¡é“æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ
ç®¡é“æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¸¦æœ‰ `@Injectable()` è£…é¥°å™¨çš„ç±»ï¼Œå®ƒå®ç°äº† `PipeTransform` æ¥å£ã€‚ç®¡é“ä¸»è¦è´Ÿè´£ä¸¤ä»¶äº‹ï¼š

1. **æ•°æ®è½¬æ¢ (Transformation)**ï¼šæŠŠè¾“å…¥æ•°æ®å˜æˆæˆ‘ä»¬éœ€è¦çš„æ ¼å¼ã€‚æ¯”å¦‚å°†è·¯ç”±å‚æ•°ä¸­çš„å­—ç¬¦ä¸² `"123"` è½¬æ¢æˆæ•°å­— `123`ã€‚
2. **æ•°æ®éªŒè¯ (Validation)**ï¼šæ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚å¦‚æœæ•°æ®æœ‰é—®é¢˜ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸å‘Šè¯‰å®¢æˆ·ç«¯å“ªé‡Œå‡ºé”™äº†ã€‚

ç®¡é“çš„æ‰§è¡Œæ—¶æœºå¾ˆå…³é”® â€”â€” å®ƒä»¬åœ¨æ§åˆ¶å™¨å¤„ç†ç¨‹åºä¹‹å‰è¿è¡Œã€‚

å½“è¯·æ±‚è¿›æ¥æ—¶ï¼ŒNest ä¼šå…ˆæŠŠæ•°æ®äº¤ç»™ç®¡é“å¤„ç†ï¼Œå¤„ç†å®Œæˆåï¼Œæ§åˆ¶å™¨æ–¹æ³•æ‰ä¼šæ¥æ”¶åˆ°ï¼ˆå¯èƒ½å·²ç»è¢«å¤„ç†è¿‡çš„ï¼‰æ•°æ®ã€‚è¿™æ ·è®¾è®¡è®©æˆ‘ä»¬çš„æ§åˆ¶å™¨èƒ½æ›´ä¸“æ³¨äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ã€‚



## Nest å†…ç½®ç®¡é“ä¸€è§ˆ
`@nestjs/common` åŒ…ä¸ºæˆ‘ä»¬æä¾›äº†ä¸°å¯Œçš„å†…ç½®ç®¡é“ï¼š

+ **ValidationPipe**ï¼šåŠŸèƒ½å¼ºå¤§çš„éªŒè¯ç®¡é“ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»
+ **ParseIntPipe**ï¼šå­—ç¬¦ä¸²è½¬æ•´æ•°
+ **ParseFloatPipe**ï¼šå­—ç¬¦ä¸²è½¬æµ®ç‚¹æ•°
+ **ParseBoolPipe**ï¼šå­—ç¬¦ä¸²è½¬å¸ƒå°”å€¼
+ **ParseArrayPipe**ï¼šå­—ç¬¦ä¸²è½¬æ•°ç»„
+ **ParseUUIDPipe**ï¼šéªŒè¯ UUID æ ¼å¼
+ **ParseEnumPipe**ï¼šéªŒè¯æšä¸¾å€¼
+ **DefaultValuePipe**ï¼šæä¾›é»˜è®¤å€¼
+ **ParseFilePipe**ï¼šæ–‡ä»¶ä¸Šä¼ éªŒè¯

æç¤ºï¼šå¦‚æœéœ€è¦å°†å­—ç¬¦ä¸²è§£æä¸º `Date`ï¼ŒNest å¹¶æœªå†…ç½® `ParseDatePipe`ï¼Œå¯ä»¥é€šè¿‡å®ç°è‡ªå®šä¹‰ç®¡é“æ¥å®Œæˆç±»ä¼¼åŠŸèƒ½ã€‚

è®©æˆ‘ä»¬çœ‹ä¸ª ğŸŒ°ï¼Œä½¿ç”¨ `ParseIntPipe` å¤„ç†è·¯ç”±å‚æ•°ï¼š

```typescript
import { Controller, Get, Param, ParseIntPipe, HttpStatus } from '@nestjs/common';
import { CatsService } from './cats.service';

@Controller('cats')
export class CatsController {
  constructor(private catsService: CatsService) {}

  @Get(':id')
  async findOne(@Param('id', ParseIntPipe) id: number) {
    // è¿™é‡Œ id è‚¯å®šæ˜¯ number ç±»å‹
    console.log(typeof id); // è¾“å‡º 'number'
    return this.catsService.findOne(id);
  }
}
```

å¦‚æœæœ‰äººè¯·æ±‚ `GET /cats/abc`ï¼Œå› ä¸º `"abc"` æ— æ³•è½¬æ¢æˆæ•°å­—ï¼Œ`ParseIntPipe` ä¼šè‡ªåŠ¨æŠ›å‡º 400 é”™è¯¯ï¼š

```json
{
  "statusCode": 400,
  "message": "Validation failed (numeric string is expected)",
  "error": "Bad Request"
}
```

æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰é”™è¯¯çŠ¶æ€ç ï¼š

```typescript
@Get(':id')
async findOne(
  // ä¼ é€’çš„æ˜¯ç±»å®ä¾‹
  @Param('id', new ParseIntPipe({ errorHttpStatusCode: HttpStatus.NOT_ACCEPTABLE }))
  id: number,
) {
  return this.catsService.findOne(id);
}
```

å…¶ä»–çš„ `Parse*` ç®¡é“ç”¨æ³•ç±»ä¼¼ï¼Œå¯ä»¥ç”¨åœ¨ `@Param()`, `@Query()`, `@Body()` ç­‰åœ°æ–¹ã€‚æ¯”å¦‚éªŒè¯ UUIDï¼š

```typescript
import { ParseUUIDPipe } from '@nestjs/common';

@Get(':uuid')
async findOneByUUID(@Param('uuid', new ParseUUIDPipe()) uuid: string) {
  // å¦‚æœä¼ å…¥çš„ uuid æ ¼å¼ä¸å¯¹ï¼Œè¿™é‡Œä¹Ÿä¼šè‡ªåŠ¨æŠ¥é”™
  return this.catsService.findOne(uuid);
}

// ä½ è¿˜å¯ä»¥æŒ‡å®š UUID ç‰ˆæœ¬ï¼Œæ¯”å¦‚åªæ¥å— v4: new ParseUUIDPipe({ version: '4' })
@Get(':uuid')
async findOneByUUID(@Param('uuid', new ParseUUIDPipe({ version: '4' })) uuid: string) {
  return this.catsService.findOne(uuid);
}
```



## åˆ›å»ºè‡ªå®šä¹‰ç®¡é“
è™½ç„¶å†…ç½®ç®¡é“å¾ˆå¼ºå¤§ï¼Œä½†æœ‰æ—¶æˆ‘ä»¬éœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡éœ€æ±‚æ¥å®šåˆ¶ç®¡é“ã€‚åˆ›å»ºè‡ªå®šä¹‰ç®¡é“å¾ˆç®€å•ï¼Œåªéœ€è¦å®ç° `PipeTransform` æ¥å£ï¼š

```typescript
// validation.pipe.ts
import { PipeTransform, Injectable, ArgumentMetadata, BadRequestException } from '@nestjs/common';

@Injectable()
export class SimpleValidationPipe implements PipeTransform {
  transform(value: any, metadata: ArgumentMetadata) {
    console.log('ç®¡é“æ¥æ”¶åˆ°çš„åŸå§‹å€¼:', value);

    // è¿™é‡Œå¯ä»¥æ·»åŠ ä½ çš„è½¬æ¢æˆ–éªŒè¯é€»è¾‘

    // å¦‚æœéªŒè¯å¤±è´¥ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œæ¯”å¦‚ï¼š
    // if (typeof value !== 'string') {
    //   throw new BadRequestException('Value must be a string.');
    // }

    // å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¿”å›å¤„ç†åçš„å€¼ï¼ˆæˆ–è€…åŸå§‹å€¼ï¼‰
    return value;
  }
}
```

`transform(value, metadata)` æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼š

+ `value`: å½“å‰æ­£åœ¨å¤„ç†çš„å‚æ•°å€¼
+ `metadata`: å‚æ•°çš„å…ƒæ•°æ®ï¼ŒåŒ…å«ï¼š
    - `type`: å‚æ•°æ¥æºï¼ˆ'body', 'query', 'param', 'custom'ï¼‰
    - `metatype`: å‚æ•°ç±»å‹ï¼ˆString, Number æˆ–è‡ªå®šä¹‰ DTO ç±»ï¼‰
    - `data`: ä¼ ç»™è£…é¥°å™¨çš„å­—ç¬¦ä¸²ï¼Œå¦‚ `@Body('user')` ä¸­çš„ `'user'`



## ç”¨ç®¡é“åšå¤æ‚éªŒè¯
å‡è®¾æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ª Catï¼Œéœ€è¦éªŒè¯åŒ…å« nameã€ageã€breed çš„å¯¹è±¡ã€‚æœ‰ä¸¤ç§ä¸»æµçš„éªŒè¯æ–¹æ¡ˆï¼š

```typescript
// create-cat.dto.ts
export class CreateCatDto {
  name: string;
  age: number;
  breed: string;
}

// cats.controller.ts
import { Body, Post, UsePipes } from '@nestjs/common';
import { CreateCatDto } from './dto/create-cat.dto';

@Post()
async create(@Body() createCatDto: CreateCatDto) {
  // æˆ‘ä»¬å¸Œæœ›åœ¨è¿™é‡Œä¹‹å‰ï¼ŒcreateCatDto å°±å·²ç»è¢«éªŒè¯è¿‡äº†
  this.catsService.create(createCatDto);
}
```

æ€ä¹ˆåšéªŒè¯å‘¢ï¼Ÿ

### ä½¿ç”¨ Zod (åŸºäº Schema)
Zod æ˜¯ä¸€ä¸ªæµè¡Œçš„ Schema éªŒè¯åº“ã€‚

1. å®‰è£…ï¼š`npm install --save zod`
2. åˆ›å»º Zod Schemaï¼š

```typescript
// shared/schemas/cat.schema.ts
import { z } from 'zod';

export const createCatSchema = z
  .object({
    name: z.string().min(1), // åå­—ä¸èƒ½ä¸ºç©º
    age: z.number().int().positive(), // å¹´é¾„å¿…é¡»æ˜¯æ­£æ•´æ•°
    breed: z.string().min(1), // å“ç§ä¸èƒ½ä¸ºç©º
  })
  .required(); // æ•´ä¸ªå¯¹è±¡æ˜¯å¿…éœ€çš„

// ä» Schema æ¨æ–­å‡º TypeScript ç±»å‹
export type CreateCatDto = z.infer<typeof createCatSchema>;
```

3. åˆ›å»º Zod éªŒè¯ç®¡é“ï¼š

```typescript
// common/pipes/zod-validation.pipe.ts
import { PipeTransform, ArgumentMetadata, BadRequestException } from '@nestjs/common';
import { ZodSchema } from 'zod';

export class ZodValidationPipe implements PipeTransform {
  constructor(private schema: ZodSchema) {}

  transform(value: unknown, metadata: ArgumentMetadata) {
    try {
      const parsedValue = this.schema.parse(value);
      return parsedValue; // éªŒè¯é€šè¿‡ï¼Œè¿”å›è§£æåçš„å€¼
    } catch (error) {
      // Zod æŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯æ¯”è¾ƒè¯¦ç»†ï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥æŠ›å‡ºæˆ–æ ¼å¼åŒ–
      throw new BadRequestException('Validation failed: ' + error.errors.map(e => `${e.path.join('.')} ${e.message}`).join(', '));
    }
  }
}
```

4. åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šä½¿ç”¨ `@UsePipes` ç»‘å®šç®¡é“ï¼š

```typescript
// cats.controller.ts
import { ZodValidationPipe } from '../common/pipes/zod-validation.pipe';
import { createCatSchema, CreateCatDto } from '../shared/schemas/cat.schema'; // æ³¨æ„è¿™é‡Œ DTO ç±»å‹ä¹Ÿä» schema å¯¼å…¥

@Post()
@UsePipes(new ZodValidationPipe(createCatSchema)) // åœ¨æ–¹æ³•çº§åˆ«åº”ç”¨ç®¡é“
async create(@Body() createCatDto: CreateCatDto) { // å‚æ•°ç±»å‹ä½¿ç”¨ Zod æ¨æ–­å‡ºçš„ç±»å‹
  this.catsService.create(createCatDto);
}
```

ä½¿ç”¨ Zod å¯èƒ½éœ€è¦åœ¨ `tsconfig.json` ä¸­å¯ç”¨ `strictNullChecks`ã€‚

å¯ç”¨ `strictNullChecks` èƒ½è®© Zod æ¨æ–­çš„ TypeScript ç±»å‹æ›´ç²¾ç¡®ï¼Œå¹¶åœ¨ç¼–è¯‘æ—¶å°±å¸®ä½ å‘ç°æ½œåœ¨çš„ `null` æˆ– `undefined` é—®é¢˜ï¼Œä»è€Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚

### ä½¿ç”¨ class-validator (åŸºäºè£…é¥°å™¨)
è¿™æ˜¯ Nest å®˜æ–¹æ–‡æ¡£æ¨èçš„æ–¹å¼ï¼Œä¸ TypeScript ç»“åˆå¾—å¾ˆå¥½ï¼š

1. å®‰è£…ï¼š`npm i --save class-validator class-transformer`
2. ç»™ DTO ç±»åŠ ä¸Šè£…é¥°å™¨ï¼š

```typescript
// create-cat.dto.ts
import { IsString, IsInt, Min, MinLength } from 'class-validator';

export class CreateCatDto {
  @IsString()
  @MinLength(1) // åå­—ä¸èƒ½ä¸ºç©º
  name: string;

  @IsInt()
  @Min(1) // å¹´é¾„æœ€å°ä¸º 1
  age: number;

  @IsString()
  @MinLength(1) // å“ç§ä¸èƒ½ä¸ºç©º
  breed: string;
}
```

3. ä½¿ç”¨å†…ç½®çš„ ValidationPipeï¼š

```typescript
// cats.controller.ts
import { ValidationPipe } from '@nestjs/common'; // å¯¼å…¥å†…ç½®çš„ ValidationPipe

@Post()
async create(
  @Body(new ValidationPipe()) createCatDto: CreateCatDto, // åœ¨ @Body è£…é¥°å™¨é‡Œåº”ç”¨ç®¡é“
) {
  this.catsService.create(createCatDto);
}
```

æˆ–è€…ï¼Œæ›´å¸¸è§çš„åšæ³•æ˜¯ï¼ŒæŠŠå®ƒè®¾ç½®æˆ**å…¨å±€ç®¡é“**ã€‚



## å…¨å±€ç®¡é“
å¦‚æœéªŒè¯é€»è¾‘åœ¨æ•´ä¸ªåº”ç”¨ä¸­éƒ½é€‚ç”¨ï¼Œå¯ä»¥è®¾ç½®å…¨å±€ç®¡é“ï¼Œé¿å…é‡å¤é…ç½®ï¼š

```typescript
// main.ts
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { ValidationPipe } from '@nestjs/common';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // è®¾ç½®å…¨å±€ç®¡é“
  app.useGlobalPipes(new ValidationPipe({
    whitelist: true, // è‡ªåŠ¨ç§»é™¤ DTO ä¸­æ²¡æœ‰å®šä¹‰çš„å±æ€§
    forbidNonWhitelisted: true, // å¦‚æœæœ‰å¤šä½™å±æ€§ï¼Œç›´æ¥æŠ¥é”™
    transform: true, // è‡ªåŠ¨å°†ä¼ å…¥çš„æ•°æ®è½¬æ¢ä¸º DTO å®ä¾‹ (æ¯”å¦‚æŠŠæŸ¥è¯¢å‚æ•°çš„å­—ç¬¦ä¸²è½¬æˆæ•°å­—)
    transformOptions: {
      enableImplicitConversion: true, // å…è®¸åŸºäº TS ç±»å‹çš„éšå¼è½¬æ¢
    },
  }));

  await app.listen(process.env.PORT ?? 3000);
}
bootstrap();
```

å¦‚æœç®¡é“éœ€è¦ä¾èµ–æ³¨å…¥ï¼Œå¯ä»¥é€šè¿‡æ¨¡å— Provider æ–¹å¼æ³¨å†Œï¼š

```typescript
// app.module.ts
import { Module } from '@nestjs/common';
import { APP_PIPE } from '@nestjs/core';
import { ValidationPipe } from '@nestjs/common'; // å‡è®¾ ValidationPipe åœ¨è¿™é‡Œæˆ–è€…è¢«å¯¼å…¥

@Module({
  // ... å…¶ä»–é…ç½®
  providers: [
    {
      provide: APP_PIPE, // å›ºå®š Token
      useClass: ValidationPipe, // ä½¿ç”¨å“ªä¸ªç®¡é“ç±»
    },
  ],
})
export class AppModule {}
```

****

## å¤„ç†å¯é€‰å‚æ•°ï¼šDefaultValuePipe
æŸ¥è¯¢å‚æ•°ç»å¸¸æ˜¯å¯é€‰çš„ã€‚æ¯”å¦‚ `/cats?activeOnly=true&page=1`ï¼Œå¦‚æœç”¨æˆ·ä¸ä¼  `page`ï¼Œæˆ‘ä»¬å¸Œæœ›é»˜è®¤ä¸º 0ã€‚ä½†ç›´æ¥ç”¨ `ParseIntPipe` å¤„ç† `undefined` å€¼ä¼šæŠ¥é”™ã€‚

è¿™æ—¶ `DefaultValuePipe` å°±å¾ˆæœ‰ç”¨äº†ï¼Œå®ƒè¦æ”¾åœ¨å…¶ä»–ç®¡é“ä¹‹å‰ï¼š

```typescript
import { DefaultValuePipe, ParseBoolPipe, ParseIntPipe } from '@nestjs/common';

@Get()
async findAll(
  @Query('activeOnly', new DefaultValuePipe(false), ParseBoolPipe) activeOnly: boolean,
  @Query('page', new DefaultValuePipe(0), ParseIntPipe) page: number,
) {
  // å¦‚æœè¯·æ±‚æ˜¯ /catsï¼Œé‚£ä¹ˆ activeOnly ä¼šæ˜¯ falseï¼Œpage ä¼šæ˜¯ 0
  // å¦‚æœè¯·æ±‚æ˜¯ /cats?activeOnly=trueï¼Œé‚£ä¹ˆ activeOnly æ˜¯ trueï¼Œpage æ˜¯ 0
  // å¦‚æœè¯·æ±‚æ˜¯ /cats?page=2ï¼Œé‚£ä¹ˆ activeOnly æ˜¯ falseï¼Œpage æ˜¯ 2
  return this.catsService.findAll({ activeOnly, page });
}
```



## å†…ç½®ç®¡é“ç¤ºä¾‹
Nest å†…ç½®çš„ Pipeï¼š

+ ValidationPipe
+ ParseIntPipe
+ ParseBoolPipe
+ ParseArrayPipe
+ ParseUUIDPipe
+ DefaultValuePipe
+ ParseEnumPipe
+ ParseFloatPipe
+ ParseFilePipe

åˆ›å»ºé¡¹ç›®ï¼š

```bash
nest new pipe-test -p npm
```

### ParseIntPipe
`ParseIntPipe` è½¬æ¢å‚æ•°ä¸ºæ•´æ•°ï¼Œæ— æ³•è½¬æ¢æˆ–è€…è½¬æ¢åä¸æ˜¯æ•´æ•°åˆ™æŠ›å‡ºå¼‚å¸¸ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708918504892-c5cb3b85-ea05-448e-909d-b4d995b2d3f7.png)

è®¿é—®é¡µé¢å¯ä»¥çœ‹å‡º age æ˜¯å­—ç¬¦ä¸²ï¼Œå› ä¸ºå­—ç¬¦ä¸² + æ•°å­—æ‰ä¼šæ‹¼æ¥ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708918554850-37a0d8f6-bb44-4491-b5fe-ba7fcfb2f09a.png)

æˆ‘ä»¬ä½¿ç”¨ `ParseIntPipe` ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708918629100-73c4b44f-5bf7-4b98-ad59-07f0d1236c31.png)

æ­£ç¡®ç›¸åŠ ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708918647386-e2d1870d-e7be-4681-8692-8fc7b5597608.png)

ä¼ é€’ä¸€ä¸ªæ— æ³•è½¬æ¢æ•´æ•°çš„ä¼šæŠ¥é”™ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708918705736-c57ad3ea-101c-4cf4-82db-27f44eb707fe.png)

æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰é”™è¯¯ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708918848499-b8a0a659-60d7-45d3-aca6-e04c0e681091.png)

é‡æ–°è®¿é—®ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708918875294-192162c6-fa97-4a3f-b5cf-9f4712317a2c.png)

è¿™é‡Œä¹Ÿå¯ä»¥é€šè¿‡ exceptionFactory é€‰é¡¹è‡ªå®šä¹‰å¼‚å¸¸å·¥å‚å‡½æ•°ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè®©å¼‚å¸¸è¿‡æ»¤å™¨è‡ªå·±å¤„ç†ã€‚

### ParseFloatPipe
`ParseFloatPipe` æ˜¯å°†å‚æ•°è½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708919184905-ab6878a2-09d3-46c5-a605-a88455700858.png)

è®¿é—®ä¸‹ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708919240322-45205f22-de9c-4605-a126-dcd6f553f25a.png)

åŒæ ·æ”¯æŒ  new ParseFloatPipe çš„å½¢å¼ï¼Œå¯ä¼ å…¥ errorHttpStatusCode å’Œ exceptionFactory é€‰é¡¹è‡ªå®šä¹‰é”™è¯¯ã€‚

### ParseBoolPipe
`ParseBoolPipe` ç”¨äºå°†è¾“å…¥çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚å¦‚æœè¾“å…¥çš„å€¼æ— æ³•è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708932264846-b7476564-2b10-4953-b4b4-e155cd280de6.png)

### ParseEnumPipe
`ParseEnumPipe` ç”¨äºç¡®ä¿è¾“å…¥çš„å€¼æ˜¯ç‰¹å®šæšä¸¾ä¸­çš„ä¸€ä¸ªæœ‰æ•ˆå€¼ã€‚å¦‚æœè¾“å…¥çš„å€¼ä¸åœ¨æšä¸¾ä¸­ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708932976521-09ff7aee-d859-4fe5-8e96-3e611c90d3be.png)

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708933000007-bc378202-e39c-40af-825b-9dca745ba262.png)

å¦‚æœ role çš„å€¼ä¸æ˜¯ admin æˆ– userï¼Œåˆ™ä¼šæŠ›å‡º BadRequestExceptionã€‚

ä¹ŸåŒæ ·å¯ä»¥é€šè¿‡ errorHttpStatusCode å’Œ exceptionFactory æ¥è‡ªå®šä¹‰é”™è¯¯ã€‚

### ParseUUIDPipe
ParseUUIDPipe ç”¨äºéªŒè¯è¾“å…¥çš„å­—ç¬¦ä¸²æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ UUIDï¼ˆé€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰ã€‚å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„ UUIDï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

æˆ‘ä»¬ç”¨ uuid åŒ…å¯ä»¥ç”Ÿæˆ uuidï¼š

![](https://cdn.nlark.com/yuque/0/2023/png/21596389/1687082116898-e8838786-5a3c-4aaf-a66f-806db4ec5a98.png)

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708933172594-7eb03c63-78fc-40ed-a39d-1eac2d24710c.png)

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708933876802-35492d6b-28ca-4049-8f33-d13c5a09bb90.png)

### DefaultValuePipe
DefaultValuePipe ç”¨äºä¸ºå‚æ•°æä¾›ä¸€ä¸ªé»˜è®¤å€¼ï¼š

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708934065988-a2ee5b50-5327-45cb-846b-dfcc4c087ff9.png)

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708934099936-90b6fd8b-8b8d-404b-8c29-b178aef72ca8.png)

### ParseArrayPipe
ç”¨äºå°†å®¢æˆ·ç«¯å‘é€çš„å­—ç¬¦ä¸²æ•°ç»„è§£æä¸ºå®é™…çš„æ•°ç»„ç±»å‹ï¼š

å…ˆå®‰è£… class-validator åŒ…ï¼Œè¿™æ˜¯å¯ä»¥ç”¨è£…é¥°å™¨å’Œéè£…é¥°å™¨ä¸¤ç§æ–¹å¼å¯¹ class å±æ€§åšéªŒè¯çš„åº“ã€‚

å†å®‰è£… class-transformer åŒ…ï¼Œå®ƒæ˜¯æŠŠæ™®é€šå¯¹è±¡è½¬æ¢ä¸ºå¯¹åº”çš„ class å®ä¾‹çš„åŒ…ã€‚

```bash
npm install class-validator class-transformer -D
```

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708934607458-14e8bff0-9616-4ce7-8b4e-57cdd30a17d6.png)

![](https://cdn.nlark.com/yuque/0/2024/png/21596389/1708934568422-93cf58c2-e5d1-40c1-ad7b-5da59d103191.png)

è¿˜å‰©ä¸‹ ValidationPipe å’Œ ParseFilePipeï¼Œä¹‹åå†è®²ã€‚
