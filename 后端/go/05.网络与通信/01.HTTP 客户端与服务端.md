# AI Prompt: 深入解析 Go net/http 包

请你扮演一位在 Go Web 开发领域有深厚造诣的技术专家，撰写一篇关于 Go 标准库 `net/http` 的综合性技术文章。

**文章目标：**
旨在让读者（从初学者到中级开发者）全面掌握 `net/http` 包的核心功能，不仅能用它构建稳健的 HTTP 客户端和服务器，还能理解其背后的设计哲学和最佳实践。

**核心内容：**

1.  **开篇：`net/http` 的设计哲学**
    *   简介 `net/http` 在 Go 生态中的核心地位。
    *   强调其设计的简洁性、组合性和高效性，特别是 `http.Handler` 和 `http.HandlerFunc` 接口的核心作用。

2.  **构建 HTTP 客户端**
    *   **简单请求**：演示如何使用 `http.Get`、`http.Post` 和 `http.PostForm` 发起基本请求。
    *   **定制化客户端 `http.Client`**：
        *   解释为何需要定制 `http.Client`（例如，设置超时、管理连接池、添加自定义 Header）。
        *   详细介绍 `http.Client` 结构体，特别是 `Transport`、`Timeout` 和 `Jar` 字段。
        *   **代码示例**：创建一个带有超时设置和自定义 User-Agent 的 `http.Client`。
    *   **处理请求上下文 `context.Context`**：演示如何使用 `http.NewRequestWithContext` 来控制请求的生命周期，实现取消或超时。
    *   **常见陷阱**：
        *   忘记关闭 `response.Body` 导致的内存泄漏。
        *   未使用 `http.Client` 导致的连接复用问题。

3.  **构建 HTTP 服务端**
    *   **最简服务器**：使用 `http.ListenAndServe` 和 `http.HandleFunc` 启动一个 “Hello, World!” 服务器。
    *   **核心接口 `http.Handler`**：
        *   深入讲解 `http.Handler` 接口的 `ServeHTTP(ResponseWriter, *Request)` 方法。
        *   演示如何通过实现该接口来创建自定义的处理器。
    *   **路由与 `http.ServeMux`**：
        *   介绍默认的 `DefaultServeMux` 和如何创建自定义的 `http.ServeMux`。
        *   讲解路由注册 `mux.Handle` 和 `mux.HandleFunc` 的区别。
        *   讨论 `ServeMux` 在路径匹配上的行为（最长匹配原则）。
    *   **中间件（Middleware）模式**：
        *   解释中间件的概念及其在 Web 开发中的重要性（如日志、认证、恢复）。
        *   **代码示例**：通过函数闭包实现一个简单的日志中间件，并展示如何将其应用于特定的处理器。
    *   **服务器的优雅关闭（Graceful Shutdown）**：
        *   解释为何需要优雅关闭（处理完进行中的请求）。
        *   **代码示例**：结合 `os.Signal` 和 `context`，演示如何实现服务器的平滑关闭。
    *   **配置 `http.Server`**：详细介绍 `http.Server` 结构体，包括 `Addr`、`Handler`、`ReadTimeout`、`WriteTimeout` 和 `IdleTimeout` 的重要性。

**代码要求：**
*   所有代码示例必须完整、可直接运行。
*   遵循 Go 的编码规范（`gofmt`）。
*   关键代码行需要有注释解释其作用。

**总结：**
回顾 `net/http` 的强大与灵活性，并指出虽然它功能强大，但在构建复杂应用时，开发者可能会选择功能更丰富的第三方 Web 框架（如 Gin、Echo），但理解 `net/http` 永远是成为 Go Web 高手的基础。
