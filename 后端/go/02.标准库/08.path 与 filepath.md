# `path` 与 `filepath`：Go 路径操作的正确姿势

请你扮演一位 Go 语言的库设计者和跨平台开发专家，为一篇名为《`path` 与 `filepath`：Go 路径操作的正确姿势》的教程生成内容。

**文章目标：** 帮助 Go 开发者清晰地辨别 `path` 和 `filepath` 这两个标准库包的核心区别，并学会在正确的场景下使用正确的包，从而编写出健壮、可移植的路径操作代码。

**内容要求：**

1.  **引言：为什么有两个路径处理包？**
    *   开篇提出这个令许多初学者困惑的问题：为什么 Go 标准库同时提供了 `path` 和 `filepath`？
    *   直接给出核心答案：**`filepath` 用于处理与操作系统相关的文件路径，而 `path` 用于处理在任何操作系统上都应保持一致的、用斜杠 `/` 分隔的路径（如 URL 路径）。**
    *   强调错误地混用这两个包是导致程序在不同操作系统（特别是 Windows 和 Unix-like 系统）上行为不一致的常见原因。

2.  **`filepath` 包：处理本地文件系统路径**
    *   将其定位为**进行文件系统操作时唯一正确的选择**。
    *   **核心功能一：跨平台路径构建**
        *   `filepath.Join(elem ...string)`: **这是最重要的函数**。解释它会根据当前操作系统的规则，自动使用正确的路径分隔符（Windows 上是 `\`，Linux/macOS 上是 `/`）来连接路径组件。
        *   提供一个反面教材：手动使用 `"/"` 拼接路径在 Windows 上会产生无效路径。
    *   **核心功能二：路径解析与分解**
        *   `filepath.Dir(path)`: 获取路径中除最后一个元素外的所有部分（目录）。
        *   `filepath.Base(path)`: 获取路径中的最后一个元素（文件名或目录名）。
        *   `filepath.Ext(path)`: 获取文件的扩展名（带点 `.`）。
    *   **核心功能三：路径清理与计算**
        *   `filepath.Clean(path)`: 清理路径，解析 `..` 和 `.`，去除多余的斜杠。
        *   `filepath.Abs(path)`: 将一个相对路径转换为绝对路径。
        *   `filepath.IsAbs(path)`: 判断一个路径是否是绝对路径。
    *   **核心功能四：遍历目录树**
        *   `filepath.Walk(root, fn WalkFunc)`: 递归地遍历从 `root` 开始的整个目录树。解释 `WalkFunc` 的签名 `func(path string, info os.FileInfo, err error) error`，并展示如何使用它来处理每个文件和目录。
        *   说明如何从 `WalkFunc` 中返回 `filepath.SkipDir` 来跳过对某个目录的遍历。

3.  **`path` 包：处理 URL 和虚拟路径**
    *   明确其使用场景：**任何与本地文件系统无关，且需要用 `/` 作为分隔符的路径**。
    *   **主要应用举例**：
        *   处理 HTTP URL 的路径部分。
        *   操作压缩包（如 zip, tar）内的文件路径。
        *   在网络服务中定义 RESTful API 的路由规则。
    *   **函数对比**：说明 `path` 包也提供了 `Join`, `Dir`, `Base`, `Ext`, `Clean` 等同名函数，但它们的行为**总是**基于 `/` 分隔符，与操作系统无关。
    *   提供一个清晰的示例：在 Windows 上运行的程序，需要构建一个 URL `http://example.com/api/v1/users`。展示如果误用 `filepath.Join("api", "v1", "users")` 会得到错误的结果 `api\v1\users`，而 `path.Join("api", "v1", "users")` 则总是得到正确的 `api/v1/users`。

4.  **总结与黄金法则**
    *   用一个清晰的表格总结 `filepath` 和 `path` 的区别。

| 特性 | `filepath` | `path` |
| :--- | :--- | :--- |
| **用途** | 本地文件系统路径 | URL 路径、虚拟路径 |
| **分隔符** | 操作系统特定 (`os.PathSeparator`) | 始终为斜杠 `/` |
| **跨平台性** | 保证代码在各平台正确操作文件 | 保证路径字符串在各平台一致 |

    *   **黄金法则**：
        *   只要你的代码在和磁盘上的文件、目录打交道，就**必须**使用 `filepath`。
        *   当你处理的是 URL、API 路由或其他与操作系统无关的路径字符串时，才应该使用 `path`。
        *   **永远不要**手动拼接路径字符串，尤其是不要硬编码 `/` 或 `\`。

**代码示例要求：**
*   为 `filepath.Join` 提供跨平台的正确示例和错误示例。
*   提供一个使用 `filepath.Walk` 遍历目录的完整示例。
*   提供一个 `path.Join` 和 `filepath.Join` 在 Windows 环境下构建 URL 路径的对比示例，以突显其核心差异。
