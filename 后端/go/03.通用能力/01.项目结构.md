# 项目结构

---

请你扮演一位经验丰富的 Go 架构师，为 Go 开发者撰写一篇关于“Go 项目结构”的权威指南。这篇文章需要深入、实用，并能解释清楚“如何做”以及“为什么这么做”。

**文章目标：**

本文旨在为开发者提供一个强大且可扩展的 Go 项目结构模板。读者在阅读后，应该能够理解主流 Go 项目结构的组织方式，并能根据自己项目的需求，自信地应用或裁剪这个结构。

**核心内容与结构：**

1.  **开篇：混沌与秩序**
    *   从一个痛点开始：当项目变大，代码随意堆砌会导致什么问题？（例如，依赖混乱、职责不清、难以测试、新人上手慢等）。
    *   引出核心论点：一个良好、一致的项目结构是软件质量和团队效率的“第一道防线”。它是一种架构性的决策。

2.  **业界的事实标准：`golang-standards/project-layout`**
    *   明确指出，虽然 Go 语言本身没有强制规定项目结构，但社区已经形成了一个强大的共识，即 [`golang-standards/project-layout`](https://github.com/golang-standards/project-layout)。
    *   强调这**不是一个官方标准**，而是一个通用的起点，可以（也应该）根据实际情况进行调整。

3.  **核心目录深度解读（The "Why" behind the "What"）**
    *   这是文章的重点。为每个核心目录创建一个小节，并用 `tree` 的形式展示其位置。
    *   **/cmd**
        *   **做什么？** 存放项目的主应用入口。每个子目录对应一个可执行文件。
        *   **为什么？** 将应用的“启动”和“组装”逻辑与核心业务逻辑分离。`main.go` 文件应该非常薄，只负责解析配置、初始化依赖、然后启动应用。
    *   **/internal**
        *   **做什么？** 存放项目私有的应用和库代码。
        *   **为什么？** 这是 Go 编译器强制保护的“内部领地”。放在这里的代码，无法被任何外部项目导入。这是一种强大的机制，可以防止不希望暴露的内部实现被外部依赖，从而保证了项目内部代码的重构自由。这是**最重要的目录**之一。
    *   **/pkg**
        *   **做什么？** 存放可以被外部项目安全导入的公共库代码。
        *   **为什么？** 当你希望项目中的某些通用功能（如一个自定义的 `validator` 包）被其他项目复用时，应该放在这里。它与 `/internal` 形成了鲜明的对比。
    *   **/api**
        *   **做什么？** 存放 API 契约文件，如 Protobuf (`.proto`)、OpenAPI/Swagger (`.yaml`, `.json`) 等。
        *   **为什么？** 将 API 定义与实现分离，使得 API 契约成为团队间（前端、后端、QA）沟通的“单一事实来源”。
    *   **/configs**
        *   **做什么？** 存放配置文件模板或默认配置文件。
        *   **为什么？** 将配置与代码分离。方便在不同环境中（开发、测试、生产）使用不同的配置。
    *   **/scripts**
        *   **做什么？** 存放用于辅助开发、构建、部署的各类脚本。
        *   **为什么？** 将项目的运维操作自动化、脚本化，方便团队成员和 CI/CD 系统使用。

4.  **依赖关系图：The Dependency Rule**
    *   用一张简单的图或清晰的文字来阐述依赖方向：`/cmd` 依赖 `/internal` 和 `/pkg`，但 `/internal` 和 `/pkg` **绝不能**反向依赖 `/cmd`。这体现了“洋葱架构”或“六边形架构”的思想，即业务核心不应依赖于外层的投递机制。

5.  **何时不使用 `pkg` 目录？**
    *   提出一个进阶思考：如果你的项目是一个独立的二进制应用，并不打算让其他项目来导入你的代码，那么 `/pkg` 目录可能是不必要的。你可以将所有代码都放在 `/internal` 中，这能最大化地保护你的内部实现。

**代码要求：**

*   使用 `tree -L 2` 或类似的命令输出，清晰地展示推荐的项目结构。
*   为 `/cmd/myapp/main.go` 提供一个极简的示例，展示其如何“组装”来自 `/internal` 的服务。

**总结：**

重申项目结构的重要性，并鼓励读者不要盲目地复制整个结构，而是理解其背后的原则，并根据自己的项目规模和业务复杂度，做出明智的选择。一个好的结构会随着项目的发展而演进。
