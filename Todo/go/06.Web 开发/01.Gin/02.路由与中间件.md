# AI Prompt: 深入理解 Gin 的路由与中间件

请你扮演一位资深的 Go Web 开发工程师，撰写一篇关于 Gin 框架中“路由（Routing）”和“中间件（Middleware）”两大核心概念的深度解析文章。

**文章目标：**
旨在让已经掌握 Gin 基础的开发者能够熟练运用其强大的路由功能来组织 API，并能通过编写和使用中间件来处理横切关注点（cross-cutting concerns），构建出结构清晰、可维护性高的 Web 应用。

**核心内容：**

1.  **开篇：路由与中间件的角色**
    *   简要回顾 Gin 的基础，然后引出路由和中间件在 Web 应用中的核心作用。
    *   路由：负责将特定的 HTTP 请求（方法 + URL）导向对应的处理函数。
    *   中间件：负责在请求到达处理函数之前或之后，执行一系列通用的、可复用的逻辑（如日志、认证、缓存）。

2.  **Gin 的高级路由技术**
    *   **基础路由**：快速回顾 `r.GET`, `r.POST` 等基础用法。
    *   **参数化路由（Parameterized Routes）**：
        *   演示如何定义包含参数的路由，如 `/users/:id`。
        *   **代码示例**：通过 `c.Param("id")` 获取路径参数。
        *   讲解查询字符串参数的获取方式 `c.Query("name")` 和 `c.DefaultQuery("page", "1")`。
    *   **路由分组（Route Grouping）**：
        *   解释路由分组的巨大价值：共享中间件、统一路径前缀。
        *   **代码示例**：创建一个 `/api/v1` 的路由组，并为该组应用一个认证中间件。展示如何在组内定义子路由。
        *   `v1 := r.Group("/api/v1").Use(AuthMiddleware())`

3.  **中间件的魔法**
    *   **什么是中间件？**
        *   用一个形象的比喻（如“请求处理流水线上的工人”）来解释中间件的 `c.Next()` 机制。
        *   解释中间件可以在 `c.Next()` 调用前后执行代码，从而实现请求前和响应后的逻辑处理。
    *   **内置中间件的使用**：
        *   介绍 `gin.Default()` 包含的 `Logger` 和 `Recovery` 中间件。
        *   `Logger`：记录请求日志。
        *   `Recovery`：捕获任何 `panic`，防止服务器崩溃，并返回 500 错误。
    *   **编写你自己的中间件**：
        *   **代码示例**：从零开始编写一个简单的自定义中间件，例如一个计算请求处理耗时的 `LatencyLogger`。
        *   讲解中间件函数的标准签名 `func(c *gin.Context)`。
    *   **全局、分组与单个路由中间件**：
        *   **代码示例**：分别演示如何使用 `r.Use()`（全局）、`group.Use()`（分组）以及在定义路由时直接传入（单个路由）来应用中间件。

4.  **实战案例：CORS 跨域处理**
    *   解释什么是 CORS（跨源资源共享）以及为什么浏览器会有限制。
    *   介绍如何使用官方推荐的 `github.com/gin-contrib/cors` 中间件来轻松解决跨域问题。
    *   **代码示例**：演示如何配置 CORS 中间件，允许所有来源（`cors.Default()`）或指定特定来源、方法和头信息（`cors.Config{...}`）。

**代码要求：**
*   所有代码示例需简洁、实用，并有清晰的注释。
*   路由和中间件的组合使用需要有完整的、可运行的 `main` 函数作为演示。

**总结：**
回顾路由和中间件是构建任何复杂 Gin 应用的基石。路由定义了应用的“骨架”，而中间件则为其添加了通用的“血肉”。鼓励读者多加练习，掌握通过组合不同的中间件来优雅地解决实际问题的能力。
