# AI Prompt: 实战进阶：用 Go 构建一个功能完备的博客系统

请你扮演一位资深的软件架构师和 Go 专家，为一篇关于“如何使用 Go 构建一个功能完备的博客系统”的教程，设计一份详尽的 AI Prompt。

这篇教程的目标读者是已经掌握 Go 基础并完成过简单项目（如 TODO 应用）的开发者。教程不仅要提供代码，更要深入讲解架构设计、安全实践和工程化考量。

**文章核心内容应包括：**

1.  **引言**
    *   项目愿景：从 TODO 应用到完整博客系统，我们将学习哪些进阶技能。
    *   功能范围：用户注册与登录、文章的增删改查、文章评论、用户权限控制。
    *   技术栈：Go, Gin, GORM, PostgreSQL, JWT (golang-jwt/jwt), Bcrypt, Viper (配置管理), Testify (测试)。

2.  **架构设计与项目设置**
    *   **回顾与演进**：对比 TODO 应用的分层架构，讨论在博客项目中如何优化和扩展。
    *   **数据库设计**：
        *   设计 `users`, `posts`, `comments` 三个表的关系（例如，一对多关系）。
        *   提供详细的 `CREATE TABLE` SQL 语句或 GORM 模型定义。
    *   **项目结构**：在原有分层基础上，增加 `middleware/` 和 `pkg/` 目录。
        *   `middleware/`: 存放 Gin 中间件，如认证、日志等。
        *   `pkg/`: 存放可复用的工具包，如 `jwt/`, `hash/`, `config/`。

3.  **用户认证模块 (Auth)**
    *   **密码安全**：在 `pkg/hash/` 中实现一个 `bcrypt` 的封装，用于密码的哈希和验证。
    *   **用户注册**：
        *   `POST /register`: Handler 接收用户名和密码，Service 调用 `hash` 包处理密码，Repository 将新用户存入数据库。
    *   **用户登录**：
        *   `POST /login`: Handler 接收用户名和密码，Service 验证密码，成功后使用 `pkg/jwt/` 生成 JWT Token 并返回给客户端。
    *   **代码要求**：提供完整的用户注册和登录流程的代码实现，并解释 `bcrypt` 和 JWT 的工作原理。

4.  **认证中间件与权限控制**
    *   **JWT 认证中间件** (`middleware/auth.go`)：
        *   创建一个 Gin 中间件，用于解析请求头中的 `Authorization` (Bearer Token)。
        *   验证 Token 的有效性，并将解析出的用户信息（如 UserID）存入 `gin.Context`，供后续的 Handler 使用。
    *   **路由保护**：将此中间件应用于需要登录才能访问的路由，例如创建文章、发表评论等。
    *   **代码要求**：提供认证中间件的完整实现，并展示如何在路由组 (Route Group) 中使用它。

5.  **核心业务模块 (文章与评论)**
    *   **文章 (Post) 的 CRUD**：
        *   实现 `GET /posts`, `POST /posts`, `GET /posts/:id`, `PUT /posts/:id`, `DELETE /posts/:id`。
        *   在创建、更新、删除文章时，需要通过认证中间件获取当前用户 ID，并进行权限检查（例如，只有文章作者才能修改或删除自己的文章）。
    *   **评论 (Comment) 的 CRUD**：
        *   实现 `GET /posts/:id/comments`, `POST /posts/:id/comments`。
        *   发表评论需要用户登录。
    *   **代码要求**：提供文章和评论模块关键的 Service 和 Handler 实现，重点突出权限检查的逻辑。

6.  **工程化与最佳实践**
    *   **配置管理 (`pkg/config`)**：使用 Viper 从配置文件 (`config.yaml`) 和环境变量中加载应用配置，实现配置的灵活管理。
    *   **数据库迁移**：简要介绍 `golang-migrate/migrate` 或 GORM 的迁移功能，以及为什么需要数据库迁移。
    *   **高级测试**：使用 `testify/assert` 和 `testify/mock` 编写更强大的测试。
        *   展示如何 Mock Repository 层来独立测试 Service 层。
        *   展示如何使用 `httptest` 对 API Handler 进行集成测试。

7.  **总结与展望**
    *   回顾整个项目，总结从简单应用到复杂系统的关键演进点。
    *   提出可供读者自行挑战的扩展功能：分页、缓存 (Redis)、全文搜索、角色权限系统 (RBAC) 等。

**总结要求：**

请确保教程的逻辑性和进阶性，重点突出架构设计、安全性和可测试性。代码示例需具有生产级别质量，并附有详尽的注释和解释，帮助读者不仅“知其然”，更“知其所以然”。

