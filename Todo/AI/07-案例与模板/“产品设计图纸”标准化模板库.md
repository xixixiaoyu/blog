
# 写作提示 —— 将“Prompt 模板库”类比为“基础设施即代码（IaC）模块库”

**核心类比**：将 Prompt 模板库，类比为一个团队内部的“私有 Terraform 模块注册中心（Private Terraform Registry）”。在这个体系中，每一个精心设计的 Prompt 不再是零散的文本片段，而是一个封装良好、可复用、可版本化的“基础设施模块”，可以通过代码来调用、组合和部署。

**使用说明**：
- 本提示旨在将 Prompt 工程，从一种“手艺活”，升级为一种遵循严格 DevOps 和 IaC 实践的“工程学科”。
- 你需要以“AI 平台工程师”或“Prompt 架构师”的口吻，为团队撰写一份《Prompt 即代码（Prompt as Code）开发规范》，推动 Prompt 的标准化、模块化与自动化。

**生成目标**：
- **建立“代码化”心智模型**：将 Prompt 的设计、测试、发布和迭代，完全对标一个标准的软件包或 IaC 模块的生命周期管理。强调“手写 Prompt”的时代已经过去，“代码化管理 Prompt”才是未来。
- **定义“Prompt 模块”的标准化结构**：将一个 Prompt 模板，类比为一个拥有标准接口的 Terraform 模块。它应该包含：
    - **输入变量（`variables.tf`）**：定义模块可接受的参数，如 `input_text`, `target_language` 等。
    - **核心逻辑（`main.tf`）**：基于输入变量，渲染出最终发送给 LLM 的完整 Prompt 文本。
    - **输出值（`outputs.tf`）**：定义模块期望从 LLM 返回的数据结构，例如，一个结构化的 JSON 对象。
- **推广“模块组合”优于“巨型单体”**：倡导编写功能单一、高度内聚的“小模块”（如一个“情感分类”模块），然后像搭乐高一样，将它们组合成复杂的“Prompt 工作流”，而不是试图编写一个无所不能的“巨型 Prompt”。
- **引入“自动化测试与验证”**：将 Prompt 的评估，类比为 IaC 的自动化测试。使用 `Terratest` 或类似的框架，为每个“Prompt 模块”编写单元测试和集成测试，确保其在不同输入下的输出质量稳定，防止“效果衰退”。
- **建立“私有注册中心”**：将团队的最佳实践沉淀为一个内部的“Prompt 模块市场”，团队成员可以在此发现、分享和复用高质量的、经过测试的模块，避免重复造轮子。

**大纲建议：《Prompt as Code (PaC) 开发与管理规范》**

1.  **第一章：告别手工作坊，拥抱工程化**
    *   引入类比：将 Prompt 类比为“可编程的基础设施”，阐述 PaC 的核心价值：可复用、可测试、可协作、可追溯。

2.  **第二章：“Prompt 模块”的标准结构定义**
    *   **HCL 风格的模块定义**：展示一个 `prompt-module` 的目录结构和文件定义。
    *   **代码示例 (类 HCL 语法)**：
        ```hcl
        # prompt_module/sentiment_analysis/main.prompt
        
        # 角色定义
        system """
        你是一个专业的情感分析引擎。
        请分析用户提供的文本，并以 JSON 格式返回结果。
        你的回答必须只包含 JSON 对象，不能有任何额外的解释。
        """
        
        # 用户输入
        user """
        文本："{{ .input_text }}"
        """
        ```
        ```hcl
        # prompt_module/sentiment_analysis/variables.prompt
        variable "input_text" {
          type        = string
          description = "需要被分析情感的文本。"
        }
        ```
        ```hcl
        # prompt_module/sentiment_analysis/outputs.prompt
        output "sentiment_json" {
          type = object({
            sentiment = string, // "positive", "negative", or "neutral"
            score     = number  // 情感强度得分 (0-1)
          })
          description = "情感分析的结果。"
        }
        ```

3.  **第三章：构建复杂的“Prompt 工作流”**
    *   **模块组合**：演示如何在一个更高级的模块中，调用多个基础模块。例如，一个“用户评论自动回复”工作流，可以依次调用“情感分析模块”、“翻译模块”和“草稿撰写模块”。
    *   **条件与循环**：展示如何根据一个模块的输出，来决定是否调用下一个模块。

4.  **第四章：为 Prompt 编写“单元测试”**
    *   **测试框架**：介绍 `prompt-foo` 或类似的工具，如何为 Prompt 模块编写基于断言的测试用例。
    *   **测试用例示例 (YAML)**：
        ```yaml
        # tests/test_sentiment_analysis.yaml
        prompts: ["prompt_module/sentiment_analysis/main.prompt"]
        providers: ["openai:gpt-4"]
        tests:
          - vars:
              input_text: "我爱这个产品！太棒了！"
            assert:
              - type: "json"
              - type: "javascript"
                value: "output.sentiment === 'positive' && output.score > 0.8"
        ```

5.  **第五章：发布与共享：我们的“私有模块注册中心”**
    *   **版本化发布**：如何使用 Git Tag 和 CI/CD 流程，将一个通过测试的 Prompt 模块发布到内部注册中心。
    *   **发现与复用**：团队成员如何通过 Web 界面或命令行工具，搜索并使用这些已发布的模块。

**质量检查清单**：
- **类比是否精准且具有启发性？**：DevOps 工程师是否能立即将 Terraform 的经验应用到 Prompt 管理上？
- **规范是否可执行？**：定义的模块结构和测试方法，是否有明确的工具和代码示例支持？
- **是否解决了核心痛点？**：PaC 是否有效地解决了 Prompt 难以协作、测试和复用的问题？
- **是否推动了文化变革？**：这份指南是否有助于将 Prompt 工程，从个人英雄主义，转变为团队协作的工程实践？
