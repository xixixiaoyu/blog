# Python 文件操作

## 最佳提示词

```
请详细介绍 Python 的文件操作，包括以下内容：

1. 文件基础：
   - 文件的概念与类型
   - 文件路径与目录结构
   - 绝对路径与相对路径
   - 文件编码的重要性
   - 文件操作的权限问题

2. 文件的打开与关闭：
   - open() 函数的使用
   - 文件模式（r、w、a、b、+等）
   - 文件的正确关闭
   - with 语句的使用
   - 文件对象的属性

3. 文件的读写操作：
   - 文本文件的读写
   - 二进制文件的读写
   - read()、readline()、readlines() 的区别
   - write()、writelines() 的使用
   - 文件的追加操作

4. 文件与目录操作：
   - os 模块的使用
   - pathlib 模块的使用
   - 目录的创建与删除
   - 文件的复制、移动、删除
   - 文件信息的获取

5. 高级文件操作：
   - 文件的随机访问
   - 文件的锁定机制
   - 大文件的处理技巧
   - 文件的压缩与解压
   - CSV 文件的处理
   - JSON 文件的处理

6. 文件系统最佳实践：
   - 资源管理
   - 错误处理
   - 性能优化
   - 安全考虑
   - 跨平台兼容性

请为每个概念提供详细的代码示例，包括实际应用场景和常见错误。解释文件操作的内部机制和性能考虑。
```

## 学习要点

- 理解文件系统的基本概念
- 掌握文件的打开、读写和关闭操作
- 学会使用不同的文件模式
- 理解文件编码的重要性
- 掌握 with 语句进行资源管理
- 学会使用 os 和 pathlib 模块操作文件系统
- 了解大文件处理的技巧
- 掌握常见文件格式的处理方法
- 理解文件操作的性能和安全考虑
- 学会处理文件操作中的异常

## 实践练习

1. 创建一个文本文件并写入内容
2. 读取文件内容并以不同方式显示
3. 使用 with 语句管理文件资源
4. 实现文件的复制功能
5. 处理 CSV 和 JSON 文件
6. 创建一个简单的文件管理器
7. 处理大文件时使用逐行读取
8. 实现文件的备份功能

## 代码示例模板

```python
# 基本文件操作
def basic_file_operations():
    """演示基本的文件操作"""
    # 写入文件
    with open("example.txt", "w", encoding="utf-8") as file:
        file.write("Hello, Python!\n")
        file.write("这是第二行\n")
    
    # 读取文件
    with open("example.txt", "r", encoding="utf-8") as file:
        content = file.read()
        print("文件内容:")
        print(content)
    
    # 追加内容
    with open("example.txt", "a", encoding="utf-8") as file:
        file.write("这是追加的第三行\n")
    
    # 逐行读取
    with open("example.txt", "r", encoding="utf-8") as file:
        print("逐行读取:")
        for line in file:
            print(line.strip())

# 二进制文件操作
def binary_file_operations():
    """演示二进制文件操作"""
    # 写入二进制数据
    data = b"Hello, Binary World!"
    with open("binary.dat", "wb") as file:
        file.write(data)
    
    # 读取二进制数据
    with open("binary.dat", "rb") as file:
        binary_data = file.read()
        print(f"二进制数据: {binary_data}")
        print(f"解码后: {binary_data.decode('utf-8')}")

# 使用 pathlib
def pathlib_example():
    """演示 pathlib 的使用"""
    from pathlib import Path
    
    # 创建 Path 对象
    file_path = Path("example.txt")
    
    # 检查文件是否存在
    if file_path.exists():
        print(f"文件大小: {file_path.stat().st_size} 字节")
        print(f"文件修改时间: {file_path.stat().st_mtime}")
    
    # 创建目录
    dir_path = Path("test_directory")
    dir_path.mkdir(exist_ok=True)
    
    # 在目录中创建文件
    new_file = dir_path / "new_file.txt"
    new_file.write_text("这是新文件的内容", encoding="utf-8")

# CSV 文件处理
def csv_example():
    """演示 CSV 文件处理"""
    import csv
    
    # 写入 CSV 文件
    with open("data.csv", "w", newline="", encoding="utf-8") as file:
        writer = csv.writer(file)
        writer.writerow(["姓名", "年龄", "城市"])
        writer.writerow(["张三", 25, "北京"])
        writer.writerow(["李四", 30, "上海"])
    
    # 读取 CSV 文件
    with open("data.csv", "r", encoding="utf-8") as file:
        reader = csv.reader(file)
        for row in reader:
            print(row)

# JSON 文件处理
def json_example():
    """演示 JSON 文件处理"""
    import json
    
    # 准备数据
    data = {
        "name": "张三",
        "age": 25,
        "city": "北京",
        "hobbies": ["读书", "游泳", "编程"]
    }
    
    # 写入 JSON 文件
    with open("data.json", "w", encoding="utf-8") as file:
        json.dump(data, file, ensure_ascii=False, indent=2)
    
    # 读取 JSON 文件
    with open("data.json", "r", encoding="utf-8") as file:
        loaded_data = json.load(file)
        print("从 JSON 文件读取的数据:")
        print(loaded_data)

# 大文件处理
def large_file_processing():
    """演示大文件处理技巧"""
    def process_large_file(input_file, output_file):
        """处理大文件，逐行读取和处理"""
        with open(input_file, "r", encoding="utf-8") as infile, \
             open(output_file, "w", encoding="utf-8") as outfile:
            
            for line_num, line in enumerate(infile, 1):
                # 处理每一行
                processed_line = f"第{line_num}行: {line.strip().upper()}\n"
                outfile.write(processed_line)
                
                # 每处理1000行打印进度
                if line_num % 1000 == 0:
                    print(f"已处理 {line_num} 行")
    
    # 创建测试大文件
    with open("large_input.txt", "w", encoding="utf-8") as file:
        for i in range(10000):
            file.write(f"这是第 {i+1} 行数据\n")
    
    # 处理大文件
    process_large_file("large_input.txt", "large_output.txt")

# 文件压缩
def compression_example():
    """演示文件压缩"""
    import zipfile
    import gzip
    
    # ZIP 压缩
    with zipfile.ZipFile("example.zip", "w") as zipf:
        zipf.write("example.txt")
    
    # GZIP 压缩
    with open("example.txt", "rb") as f_in:
        with gzip.open("example.txt.gz", "wb") as f_out:
            f_out.writelines(f_in)
    
    print("文件压缩完成")

# 上下文管理器示例
class FileProcessor:
    """自定义文件处理器上下文管理器"""
    def __init__(self, filename, mode):
        self.filename = filename
        self.mode = mode
        self.file = None
    
    def __enter__(self):
        self.file = open(self.filename, self.mode, encoding="utf-8")
        return self.file
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        if self.file:
            self.file.close()
        if exc_type is not None:
            print(f"文件操作发生异常: {exc_val}")
        return False  # 不抑制异常

# 使用自定义上下文管理器
def custom_context_manager_example():
    """演示自定义上下文管理器的使用"""
    with FileProcessor("example.txt", "r") as file:
        content = file.read()
        print(content)
```

## 扩展资源

- [Python 文件操作文档](https://docs.python.org/3/tutorial/inputoutput.html#reading-and-writing-files)
- [os 模块文档](https://docs.python.org/3/library/os.html)
- [pathlib 模块文档](https://docs.python.org/3/library/pathlib.html)
- [csv 模块文档](https://docs.python.org/3/library/csv.html)
- [json 模块文档](https://docs.python.org/3/library/json.html)