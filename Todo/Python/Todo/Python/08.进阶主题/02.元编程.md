# Python 元编程

## 最佳提示词

```
请详细介绍 Python 元编程，包括以下内容：

1. 装饰器进阶：
   - 类装饰器
   - 装饰器工厂
   - 装饰器链
   - 属性装饰器

2. 元类：
   - 元类概念
   - 自定义元类
   - 元类应用场景
   - 单例模式实现

3. 描述符：
   - 描述符协议
   - 数据描述符
   - 非数据描述符
   - 属性查找机制

4. 动态特性：
   - 动态属性创建
   - 动态方法添加
   - __getattr__ 和 __setattr__
   - 插件系统设计

5. AST 操作：
   - 抽象语法树
   - AST 遍历
   - 代码生成
   - 静态分析

请为每个概念提供详细的代码示例，包括实际应用场景和高级技巧。
```

## 学习要点

- 掌握装饰器的高级用法
- 理解元类的工作原理
- 学会使用描述符协议
- 掌握动态编程技巧
- 了解 AST 操作的基础

## 实践练习

1. 实现类装饰器
2. 创建自定义元类
3. 编写描述符类
4. 实现动态属性系统
5. 创建简单的插件架构
6. 使用 AST 进行代码分析

## 代码示例模板

```python
# 类装饰器
def class_decorator(cls):
    cls.new_attr = 'added by decorator'
    return cls

@class_decorator
class MyClass:
    pass

# 元类示例
class SingletonMeta(type):
    _instances = {}
    
    def __call__(cls, *args, **kwargs):
        if cls not in cls._instances:
            cls._instances[cls] = super().__call__(*args, **kwargs)
        return cls._instances[cls]

class Singleton(metaclass=SingletonMeta):
    def __init__(self):
        self.value = 0

# 描述符示例
class ValidatedAttribute:
    def __init__(self, name, validator):
        self.name = name
        self.validator = validator
    
    def __get__(self, obj, objtype=None):
        if obj is None:
            return self
        return obj.__dict__[self.name]
    
    def __set__(self, obj, value):
        if not self.validator(value):
            raise ValueError(f"Invalid value for {self.name}")
        obj.__dict__[self.name] = value

class Person:
    age = ValidatedAttribute('age', lambda x: isinstance(x, int) and x >= 0)

# 动态属性
class DynamicObject:
    def __getattr__(self, name):
        return f"Dynamic attribute: {name}"
    
    def __setattr__(self, name, value):
        print(f"Setting {name} = {value}")
        super().__setattr__(name, value)
```

## 扩展资源

- [Python 元编程指南](https://realpython.com/python-metaclasses/)
- [描述符指南](https://docs.python.org/3/howto/descriptor.html)
- [装饰器详解](https://python-3-patterns-idioms-test.readthedocs.io/en/latest/Decorators.html)
- [AST 模块文档](https://docs.python.org/3/library/ast.html)
