# Python 设计模式

## 最佳提示词

```
请详细介绍 Python 中的设计模式，包括以下内容：

1. 创建型模式：
   - 单例模式（Singleton）
   - 工厂模式（Factory）
   - 建造者模式（Builder）
   - 原型模式（Prototype）

2. 结构型模式：
   - 适配器模式（Adapter）
   - 装饰器模式（Decorator）
   - 外观模式（Facade）
   - 代理模式（Proxy）

3. 行为型模式：
   - 观察者模式（Observer）
   - 策略模式（Strategy）
   - 命令模式（Command）
   - 状态模式（State）

4. Python 特有模式：
   - Borg 模式
   - 函数式模式
   - Mixin 模式

请为每个设计模式提供详细的代码实现，包括适用场景和优缺点分析。
```

## 学习要点

- 理解设计模式的概念和重要性
- 掌握常见创建型模式的实现
- 学会使用结构型模式解决设计问题
- 理解行为型模式的应用场景
- 了解 Python 特有的设计模式
- 学会选择合适的设计模式
- 理解设计模式的优缺点
- 掌握模式的组合使用

## 实践练习

1. 实现单例模式的多种方式
2. 创建工厂模式解决对象创建问题
3. 使用装饰器模式扩展功能
4. 实现观察者模式处理事件
5. 应用策略模式实现算法切换
6. 使用适配器模式解决接口不兼容
7. 实现命令模式封装操作
8. 组合多个设计模式解决复杂问题

## 代码示例模板

```python
# 单例模式
class Singleton:
    """单例模式实现"""
    _instance = None
    _initialized = False
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
    
    def __init__(self):
        if not self._initialized:
            self.value = 0
            self._initialized = True

# 工厂模式
class Animal:
    def speak(self):
        pass

class Dog(Animal):
    def speak(self):
        return "Woof!"

class Cat(Animal):
    def speak(self):
        return "Meow!"

class AnimalFactory:
    """动物工厂"""
    @staticmethod
    def create_animal(animal_type):
        if animal_type == "dog":
            return Dog()
        elif animal_type == "cat":
            return Cat()
        else:
            raise ValueError(f"Unknown animal type: {animal_type}")

# 装饰器模式
class Coffee:
    def cost(self):
        return 5

class MilkDecorator:
    def __init__(self, coffee):
        self._coffee = coffee
    
    def cost(self):
        return self._coffee.cost() + 2

class SugarDecorator:
    def __init__(self, coffee):
        self._coffee = coffee
    
    def cost(self):
        return self._coffee.cost() + 1

# 观察者模式
class Subject:
    def __init__(self):
        self._observers = []
    
    def attach(self, observer):
        self._observers.append(observer)
    
    def detach(self, observer):
        self._observers.remove(observer)
    
    def notify(self, message):
        for observer in self._observers:
            observer.update(message)

class Observer:
    def update(self, message):
        pass

class EmailObserver(Observer):
    def update(self, message):
        print(f"Email notification: {message}")

class SMSObserver(Observer):
    def update(self, message):
        print(f"SMS notification: {message}")

# 策略模式
class PaymentStrategy:
    def pay(self, amount):
        pass

class CreditCardPayment(PaymentStrategy):
    def pay(self, amount):
        return f"Paid ${amount} via Credit Card"

class PayPalPayment(PaymentStrategy):
    def pay(self, amount):
        return f"Paid ${amount} via PayPal"

class PaymentContext:
    def __init__(self, strategy):
        self._strategy = strategy
    
    def set_strategy(self, strategy):
        self._strategy = strategy
    
    def execute_payment(self, amount):
        return self._strategy.pay(amount)

# 命令模式
class Command:
    def execute(self):
        pass

class Light:
    def turn_on(self):
        print("Light is on")
    
    def turn_off(self):
        print("Light is off")

class LightOnCommand(Command):
    def __init__(self, light):
        self._light = light
    
    def execute(self):
        self._light.turn_on()

class LightOffCommand(Command):
    def __init__(self, light):
        self._light = light
    
    def execute(self):
        self._light.turn_off()

class RemoteControl:
    def __init__(self):
        self._command = None
    
    def set_command(self, command):
        self._command = command
    
    def press_button(self):
        if self._command:
            self._command.execute()

# 适配器模式
class EuropeanSocket:
    def voltage(self):
        return 220

class AmericanDevice:
    def needs_voltage(self):
        return 110

class SocketAdapter:
    def __init__(self, socket):
        self._socket = socket
    
    def voltage(self):
        return self._socket.voltage() / 2

# 使用示例
if __name__ == "__main__":
    # 单例模式
    s1 = Singleton()
    s2 = Singleton()
    print(s1 is s2)  # True
    
    # 工厂模式
    factory = AnimalFactory()
    dog = factory.create_animal("dog")
    print(dog.speak())  # Woof!
    
    # 装饰器模式
    coffee = Coffee()
    coffee_with_milk = MilkDecorator(coffee)
    coffee_with_milk_and_sugar = SugarDecorator(coffee_with_milk)
    print(coffee_with_milk_and_sugar.cost())  # 8
    
    # 观察者模式
    subject = Subject()
    email_obs = EmailObserver()
    sms_obs = SMSObserver()
    subject.attach(email_obs)
    subject.attach(sms_obs)
    subject.notify("New message received")
    
    # 策略模式
    payment = PaymentContext(CreditCardPayment())
    print(payment.execute_payment(100))  # Paid $100 via Credit Card
    payment.set_strategy(PayPalPayment())
    print(payment.execute_payment(50))   # Paid $50 via PayPal
    
    # 命令模式
    light = Light()
    remote = RemoteControl()
    remote.set_command(LightOnCommand(light))
    remote.press_button()  # Light is on
    
    # 适配器模式
    socket = EuropeanSocket()
    adapter = SocketAdapter(socket)
    device = AmericanDevice()
    print(f"Socket provides {adapter.voltage()}V")  # Socket provides 110V
```

## 扩展资源

- [设计模式详解](https://refactoring.guru/design-patterns)
- [Python 设计模式](https://python-patterns.guide/)
- [Head First 设计模式](https://book.douban.com/subject/1052241/)
- [设计模式最佳实践](https://sourcemaking.com/design_patterns)